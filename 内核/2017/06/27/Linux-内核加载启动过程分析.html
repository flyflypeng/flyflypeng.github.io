<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux 内核加载启动过程分析</title>
  <meta name="description"
    content="本文是基于 Linux Kernel 4.4.49 版本内核源码中的 x86 32 位体系结构进行分析。BIOS 传统模式下的 X86 PC 启动过程什么是 BIOS？简单来说 BIOS 也是一段程序代码，但是它比较特殊，它是 CPU 启动后执行的第一段代码，存储在 PC 设备中的只读存储器（ROM）中，主要完成...">
  
  <meta name="author" content="Pengfei Jiang">
  <meta name="copyright" content="&copy; Pengfei Jiang 2022">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href=" /assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href=" /assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href=" /assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href=" /assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href=" /assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href=" /assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href=" /assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href=" /assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href=" /assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href=" /assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href=" /assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href=" /assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href=" /assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href=" /assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href=" /assets/icons/favicon-16x16.png">
  <link rel="manifest" href=" /assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content=" /assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description"
    content="本文是基于 Linux Kernel 4.4.49 版本内核源码中的 x86 32 位体系结构进行分析。BIOS 传统模式下的 X86 PC 启动过程什么是 BIOS？简单来说 BIOS 也是一段程序代码，但是它比较特殊，它是 CPU 启动后执行的第一段代码，存储在 PC 设备中的只读存储器（ROM）中，主要完成..." />
  <meta property="og:url" content="https://flyflypeng.tech" />
  <meta property="og:site_name" content="Fly Higher's Blog" />
  <meta property="og:title" content="Linux 内核加载启动过程分析" />
  <meta property="og:type" content="website" />
  <meta property="og:image"
    content="https://flyflypeng.tech/assets/instacode.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Linux 内核加载启动过程分析">
  <meta name="twitter:description"
    content="本文是基于 Linux Kernel 4.4.49 版本内核源码中的 x86 32 位体系结构进行分析。BIOS 传统模式下的 X86 PC 启动过程什么是 BIOS？简单来说 BIOS 也是一段程序代码，但是它比较特殊，它是 CPU 启动后执行的第一段代码，存储在 PC 设备中的只读存储器（ROM）中，主要完成...">
  <meta name="twitter:image"
    content="https://flyflypeng.tech/assets/instacode.png">
  <meta name="twitter:url" content="https://flyflypeng.tech">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href=" /css/main.css">
  <link rel="canonical" href="https://flyflypeng.tech/%E5%86%85%E6%A0%B8/2017/06/27/Linux-%E5%86%85%E6%A0%B8%E5%8A%A0%E8%BD%BD%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90.html">
  <link rel="alternate" type="application/rss+xml" title="Fly Higher's Blog" href="https://flyflypeng.tech /feed.xml" />

  <!-- Google analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQJMFGY2LD"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-WQJMFGY2LD');
</script>
  
</head>

  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/smile_icon.png" alt="Fly Higher's Blog">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        <li class="nav-link"><a href="/about/">About</a>
        <li class="nav-link"><a href="/posts/">Posts</a>
        <li class="nav-link"><a href="/project/">Projects</a>
        <!-- 
          
          <li class="nav-link"><a href="/about/">About</a>
          
        
          
        
          
        
          
        
          
          <li class="nav-link"><a href="/posts/">Posts</a>
          
        
          
          <li class="nav-link"><a href="/project/">Projects</a>
          
        
          
          <li class="nav-link"><a href="/tag/keyboard/">keyboard</a>
          
        
          
          <li class="nav-link"><a href="/tag/virtual/">virtual</a>
          
        
          
          <li class="nav-link"><a href="/tag/android/">Android</a>
          
        
          
          <li class="nav-link"><a href="/tag/opencv/">opencv</a>
          
        
          
          <li class="nav-link"><a href="/tag/markdown/">Markdown</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E8%8B%B1%E8%AF%AD/">英语</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E5%AD%A6%E4%B9%A0/">学习</a>
          
        
          
          <li class="nav-link"><a href="/tag/hexo/">Hexo</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E5%8D%9A%E5%AE%A2/">博客</a>
          
        
          
          <li class="nav-link"><a href="/tag/ubuntu/">Ubuntu</a>
          
        
          
          <li class="nav-link"><a href="/tag/firefox/">Firefox</a>
          
        
          
          <li class="nav-link"><a href="/tag/python/">Python</a>
          
        
          
          <li class="nav-link"><a href="/tag/make/">make</a>
          
        
          
          <li class="nav-link"><a href="/tag/makefile/">Makefile</a>
          
        
          
          <li class="nav-link"><a href="/tag/linux/">Linux</a>
          
        
          
          <li class="nav-link"><a href="/tag/sublimetext/">SublimeText</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E5%86%85%E6%A0%B8/">内核</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E8%B0%83%E5%BA%A6/">调度</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E7%A1%AC%E7%9B%98/">硬盘</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a>
          
        
          
          <li class="nav-link"><a href="/tag/terminator/">Terminator</a>
          
        
          
          <li class="nav-link"><a href="/tag/cpu/">CPU</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">体系结构</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/">系统调用</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86/">时间管理</a>
          
        
          
          <li class="nav-link"><a href="/tag/vnc/">VNC</a>
          
        
          
          <li class="nav-link"><a href="/tag/rfb/">RFB</a>
          
        
          
          <li class="nav-link"><a href="/tag/container-of/">container_of</a>
          
        
          
          <li class="nav-link"><a href="/tag/offsetof/">offsetof</a>
          
        
          
          <li class="nav-link"><a href="/tag/cs/">CS</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E5%9F%BA%E7%A1%80/">基础</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E9%98%85%E8%AF%BB/">阅读</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E4%B9%A6%E5%8D%95/">书单</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E5%B0%8F%E8%AF%B4/">小说</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E6%8A%80%E6%9C%AF/">技术</a>
          
        
          
          <li class="nav-link"><a href="/tag/ndk/">NDK</a>
          
        
          
          <li class="nav-link"><a href="/tag/debug/">Debug</a>
          
        
          
          <li class="nav-link"><a href="/tag/tombstone/">Tombstone</a>
          
        
          
          <li class="nav-link"><a href="/tag/eof/">EOF</a>
          
        
          
          <li class="nav-link"><a href="/tag/git/">Git</a>
          
        
          
          <li class="nav-link"><a href="/tag/ppa/">PPA</a>
          
        
          
          <li class="nav-link"><a href="/tag/apt/">APT</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E5%90%8C%E6%AD%A5/">同步</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85/">生产者消费者</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA/">环形缓冲区</a>
          
        
          
          <li class="nav-link"><a href="/tag/ringbuffer/">RingBuffer</a>
          
        
          
          <li class="nav-link"><a href="/tag/aosp/">AOSP</a>
          
        
          
          <li class="nav-link"><a href="/tag/hal/">HAL</a>
          
        
          
          <li class="nav-link"><a href="/tag/ramfs/">ramfs</a>
          
        
          
          <li class="nav-link"><a href="/tag/tmpfs/">tmpfs</a>
          
        
          
          <li class="nav-link"><a href="/tag/rootfs/">rootfs</a>
          
        
          
          <li class="nav-link"><a href="/tag/initramfs/">initramfs</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">文件系统</a>
          
        
          
          <li class="nav-link"><a href="/tag/unix/">Unix</a>
          
        
          
          <li class="nav-link"><a href="/tag/i-o/">I/O</a>
          
        
          
          <li class="nav-link"><a href="/tag/graphic/">Graphic</a>
          
        
          
          <li class="nav-link"><a href="/tag/opengles/">OpenGLES</a>
          
        
          
          <li class="nav-link"><a href="/tag/egl/">EGL</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a>
          
        
          
          <li class="nav-link"><a href="/tag/qemu/">QEMU</a>
          
        
          
          <li class="nav-link"><a href="/tag/kvm/">KVM</a>
          
        
          
          <li class="nav-link"><a href="/tag/mac/">Mac</a>
          
        
          
          <li class="nav-link"><a href="/tag/jekyll/">Jekyll</a>
          
        
          
          <li class="nav-link"><a href="/tag/iterm2/">iTerm2</a>
          
        
          
          <li class="nav-link"><a href="/tag/zsh/">zsh</a>
          
        
          
          <li class="nav-link"><a href="/tag/kubernetes/">kubernetes</a>
          
        
          
          <li class="nav-link"><a href="/tag/k8s/">k8s</a>
          
        
          
          <li class="nav-link"><a href="/tag/cloudnative/">cloudnative</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E6%88%B7%E5%A4%96/">户外</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E9%9C%B2%E8%90%A5/">露营</a>
          
        
          
          <li class="nav-link"><a href="/tag/camp/">camp</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E7%AC%94%E8%AE%B0/">笔记</a>
          
        
          
          <li class="nav-link"><a href="/tag/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a>
          
        
          
          <li class="nav-link"><a href="/tag/ptrace/">ptrace</a>
          
        
          
          <li class="nav-link"><a href="/tag/sandbox/">sandbox</a>
          
        
          
          <li class="nav-link"><a href="/tag/kata-containers/">kata-containers</a>
          
        
          
          <li class="nav-link"><a href="/category/android/">android</a>
          
        
          
          <li class="nav-link"><a href="/category/%E5%88%A9%E5%99%A8/">利器</a>
          
        
          
          <li class="nav-link"><a href="/category/%E5%AD%A6%E4%B9%A0-%E6%95%88%E7%8E%87/">学习&效率</a>
          
        
          
          <li class="nav-link"><a href="/category/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>
          
        
          
          <li class="nav-link"><a href="/category/linux/">linux</a>
          
        
          
          <li class="nav-link"><a href="/category/%E5%86%85%E6%A0%B8/">内核</a>
          
        
          
          <li class="nav-link"><a href="/category/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">体系结构</a>
          
        
          
          <li class="nav-link"><a href="/category/%E7%94%9F%E6%B4%BB/">生活</a>
          
        
          
          <li class="nav-link"><a href="/category/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a>
          
        
          
          <li class="nav-link"><a href="/category/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a>
          
        
          
          <li class="nav-link"><a href="/category/%E6%88%B7%E5%A4%96/">户外</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
         -->
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/instacode.png);">
  <div class="scrim has-cover">
    <header class="post-header">
      <h1 class="title">Linux 内核加载启动过程分析</h1>
      <p class="info">by <strong>FlyFlyPeng</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">June 27, 2017</div>
  <div class="post-categories">
  in 
    
    <a href="/category/内核">内核</a>
    
  
  </div>
</section>

<article class="post-content">
  <p>本文是基于 <code class="language-plaintext highlighter-rouge">Linux Kernel 4.4.49</code> 版本内核源码中的 x86 32 位体系结构进行分析。</p>

<h1 id="bios-传统模式下的-x86-pc-启动过程">BIOS 传统模式下的 X86 PC 启动过程</h1>

<h2 id="什么是-bios">什么是 BIOS？</h2>
<p>简单来说 BIOS 也是一段程序代码，但是它比较特殊，它是 CPU 启动后执行的第一段代码，存储在 PC 设备中的只读存储器（ROM）中，主要完成检测内存、显卡等一系列硬件设备和建立中断向量表（IVT，Interrupt Vector Table）的工作。</p>

<p>ROM 其实也一块内存，它会被映射到 CPU 实模式下所能访问的 1MB 物理内存空间的顶部，即地址 <code class="language-plaintext highlighter-rouge">0xF000:0000 ~ 0xF000:FFFF</code>。</p>

<p>在这里补充一下， X86 处理器有两种运行模式一种是实模式，另外一种是保护模式，它们两者之间最主要的区别就是：实模式下 CPU 访问内存的地址采用的是<strong>分段</strong>方式（也就是<strong>段基址：段内便宜</strong>），生成的是可以直接访问物理内存的<strong>物理地址</strong>，而保护模式下 CPU 访问内存的地址采用的是<strong>分页</strong>方式，生成的是<strong>虚拟地址</strong>，不能直接访问物理内存，需要通过 <strong>MMU</strong> 硬件将虚拟地址转换为物理地址后才能访问物理内存。</p>

<p>X86 实模式下物理内存映射空间结构如下图所示：
<img src="https://picturebed.obs.cn-east-2.myhuaweicloud.com/blogPictures/14983994852650.jpg" alt="" /></p>

<!--more-->

<h2 id="bios-启动过程">BIOS 启动过程</h2>

<ol>
  <li>
    <p>当 X86 架构的 PC 在开机上电的一瞬间，CPU 中的 <strong>CS</strong> 和 <strong>IP</strong> 寄存器就被设置成了 <code class="language-plaintext highlighter-rouge">0xF000:FFF0</code>（这个地址就是 BIOS 代码所在内存区域），这个地址指向了 CPU 执行第一条指令的位置。而在这个地址里只存放了一条非常简单的跳转指令 <code class="language-plaintext highlighter-rouge">jmp far f000:e05b</code>，然后程序就跳转到了 BIOS 代码中的另外一个地址 <code class="language-plaintext highlighter-rouge">f000:e05b</code> 处开始接着往下执行。</p>
  </li>
  <li>
    <p>接下来，BIOS 就马不停蹄地检测内存、显卡等外设信息，当硬件检测通过之后，就在内存的物理内存的起始位置 <code class="language-plaintext highlighter-rouge">0x000 ~ 0x3FF</code> （刚好 1KB 的内存空间)建立中断向量表（IVT），如上图物理内存最底部的所示。</p>

    <p>x86 中断向量表中有 256 个中断向量，每个中断向量用 4 个字节来表示（CS 用两个字节表示，IP 也用两个字节表示），通过中断向量中保存的 <code class="language-plaintext highlighter-rouge">CS:IP</code> 地址就可以跳转到对应的中断处理程序去处理中断请求信号。</p>
  </li>
  <li>
    <p>最后，BIOS 将<strong>启动磁盘</strong>中的第 1 个扇区（MBR 扇区，Master Boot Record）的 512 个字节的数据加载到物理内存地址为 <code class="language-plaintext highlighter-rouge">0x7C00 ~ 0x7E00</code> 的区域，然后程序就跳转到 <code class="language-plaintext highlighter-rouge">0x7C00</code> 处开始执行，至此，BIOS 就完成了所有的工作，将控制权转交到了 MBR 中的代码。</p>
  </li>
</ol>

<h2 id="mbr-扇区">MBR 扇区</h2>
<p>MBR（Master Boot Record）扇区是启动磁盘中的第 1 个扇区，它主要由三部分组成：第一部分是一段引导程序，主要用来加载启动内核所需 Bootloader 程序；第二部分是当前启动磁盘的分区表；第三部分是标识 MBR 扇区的魔数 <strong>0x55</strong> 和 <strong>0xAA</strong>。</p>

<p>MBR 分区组成结构如下图所示：
<img src="https://picturebed.obs.cn-east-2.myhuaweicloud.com/blogPictures/14984029056904.jpg" alt="" /></p>

<h2 id="bootloader-加载程序">Bootloader 加载程序</h2>
<p>Bootloader 是一段用来将 Linux Kernel 镜像文件加载到物理内存中指定地址的程序，这里所指的 Bootloader 是广义上概念，其实它还可以细分成两个独立的 bootloader：</p>

<ul>
  <li><strong>第一个 bootloader</strong>：由 MBR 扇区中的前 446 个字节构成，作用是找到第二个 bootloader 并将其加载到物理内存中，并跳转到第二个 bootloader 中执行。</li>
  <li><strong>第二个 bootloader</strong>：这个 bootloader 位于启动盘中 MBR 扇区之后，根据 bootloader 代码的大小可能会占用一个或多个磁盘分区，它的主要作用就是找到磁盘中存放的 Linux Kernel 镜像文件以及 initrd 文件（如果在内核命令行参数中指定了的话），并将其加载到物理内存当中。</li>
</ul>

<p><strong>注：initrd 是 initialized ram disk 的意思。主要用于加载硬件驱动模块，辅助内核的启动，挂载真正的根文件系统。</strong></p>

<p>上述这两个 bootloader 程序合在一起就构成了我们在 Linux 系统中经常用到的两个 Bootloader 程序，LILO（Linux Loader）或者是 GRUB（Grand Unified Boot Loader）。</p>

<p>GRUB 是我们现在 Linux 发行版系统中最常用到的 Bootloader，它的<strong>优势在于它可以识别 Linux 文件系统</strong>，例如 ext3，ext4 格式的文件系统。不像 LILO 只能从原始的磁盘扇区中加载 Linux Kernel 镜像，GRUB 可以从 ext3 或者 ext4 格式文件系统的磁盘分区中加载 Linux Kernel 镜像。</p>

<p>总结一下 Bootloader 主要完成了下面几项工作：</p>

<ol>
  <li>从 MBR 扇区中的第一个 bootloader 程序跳转实际执行内核加载操作的第二个 bootloder 程序。</li>
  <li>第二个 bootloder 程序查找 Linux Kernel 镜像在启动盘中的位置（要么存放磁盘中的固定位置，要么通过文件系统去解析）。</li>
  <li>将找到的 Linux Kernel 镜像和 initrd 文件加载到物理内存中的指定地址处，并建立运行内核的所需的基本环境。</li>
  <li>最后，Bootloader 就将控制权转交到 Linux 内核，然后由内核开始执行。</li>
</ol>

<p>x86 系统中 Bootloader 加载内核启动的过程，如下图所示：
<img src="https://picturebed.obs.cn-east-2.myhuaweicloud.com/blogPictures/14984058448893.jpg" alt="" /></p>

<h1 id="linux-kernel-镜像">Linux Kernel 镜像</h1>

<h2 id="linux-kernel-镜像格式">Linux Kernel 镜像格式</h2>
<p>Linux 内核有多种格式的镜像，例如 vmlinux、Image、zImage、bzImage、uImage、xipImage、bootpImage 等。</p>

<h3 id="vmlinux">vmlinux</h3>
<p>vmlinux 是可引导的、未压缩、可压缩的内核镜像，vm 代表<strong>Virtual Memory</strong>，Linux 支持虚拟内存，因此得名 vm。它是由用户对内核源码编译得到，实质是 ELF 格式的文件，也就是说vmlinux 是编译出来的最原始的内核文件，未被压缩过。</p>

<h3 id="image">Image</h3>
<p>Image是经过 <strong>objcopy</strong> 处理的只包含二进制数据的内核代码，它已经不是 ELF 格式了，但这种格式的内核镜像还没有经过压缩。</p>

<p>objcopy 工具的作用是拷贝一个目标文件的内容到另一个目标文件中，也就是说，可以将一种格式的目标文件转换成另一种格式的目标文件。通过使用 binary 作为输出目标(-o binary)，可产生一个原始的二进制文件，实质上是将所有的符号和重定位信息都将被抛弃，只剩下二进制数据。</p>

<h3 id="zimage">zImage</h3>
<p>zImage 是 ARM Linux 常用的一种压缩镜像文件，它是由vmlinux 加上<strong>解压代码</strong>经 gzip 压缩而成，命令格式是 <code class="language-plaintext highlighter-rouge">make zImage</code>，这种格式的 Linux 内核镜像文件多存放在 NAND Flash 上。</p>

<h3 id="bzimage">bzImage</h3>
<p>bzImage 不是用 bzip2 压缩的，<strong>bz 表示 big zImage</strong>,其格式与 zImage 类似，但采用了不同的压缩算法，注意，bzImage 的压缩率更高是压缩的内核映像。</p>

<p>zImage vs bzImage：它们不仅是一个压缩文件，而且在这两个文件的开头部分内嵌有解压缩代码。两者的<strong>不同之处</strong>在于，老的<strong>zImage 解压缩内核到低端内存</strong>(第一个 640K)，<strong>bzImage解压缩内核到高端内存(1M以上)</strong>。如果内核比较小，那么可以采用 zImage 或 bzImage 之一，两种方式引导的系统运行时是相同的。大的内核采用 bzImage，不能采用 zImage。</p>

<h3 id="uimage">uImage</h3>
<p>uImage 是 uboot 专用的镜像文件，它是在 zImage 之前加上一个长度为<strong>0x40</strong>的头信息(tag)，在头信息内说明了该镜像文件的类型、加载 位置、生成时间、大小等信息。换句话说，若直接从 uImage 的0x40位置开始执行，则 zImage 和 uImage 没有任何区别，命令格式是 <code class="language-plaintext highlighter-rouge">make uImage</code>，这种格式的 Linux 镜像文件多存放在 NAND Flash 上。</p>

<h3 id="xipimage">xipImage</h3>
<p>这种格式的 Linux 镜像文件多存放在 NOR Flash 上，且运行时不需要拷贝到内存 SDRAM 中，可以直接在 NOR Flash 中运行。</p>

<p>有关 NOR Flash 和 NAND Flash 的概念和区别可以参靠下面这篇文章：<a href="http://blog.csdn.net/shuaishuai80/article/details/6202205">NorFlash和NandFlash区别</a></p>

<h2 id="linux-kernel-镜像生成过程">Linux Kernel 镜像生成过程</h2>
<p>一个可以被<strong>加载启动</strong>的 Linux 内核镜像除了包含上面介绍的最基本的压缩或者未被压缩的编译好的 Linux Kernel 镜像目标文件之外，还包含一个文件头部分和末尾的CRC校验码部分，它的结构如下图所示：</p>

<p><img src="https://picturebed.obs.cn-east-2.myhuaweicloud.com/blogPictures/Linux-kernel-boot-image.png" alt="Linux-kernel-boot-image" /></p>

<p><strong>注意</strong>：如上图所示的内核镜像中，<strong>boot/setup.bin</strong> 是实模式下执行的代码，<strong>boo/vmlinux.bin</strong> 则是保护模式下执行的代码。</p>

<p>例如，在内核从 <strong>vmlinux</strong> 文件编译生成 <strong>bzImage</strong> 内核镜像文件的过程如下所示：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MKPIGGY <span class="nb">arch</span>/x86/boot/compressed/piggy.S
  AS      <span class="nb">arch</span>/x86/boot/compressed/piggy.o <span class="c"># 编译 arch/x86/boot/compressed/piggy.S</span>
  LD      <span class="nb">arch</span>/x86/boot/compressed/vmlinux <span class="c"># 将 piggy.o 和 vmlinux 链接在一起生成 vmlinux.bin</span>
  ZOFFSET <span class="nb">arch</span>/x86/boot/zoffset.h
  OBJCOPY <span class="nb">arch</span>/x86/boot/vmlinux.bin <span class="c"># 使用 objcopy 命令去除 vmlinux 中的符号表信息</span>
  AS      <span class="nb">arch</span>/x86/boot/header.o <span class="c"># 汇编 arch/x86/boot/header.S 文件</span>
  LD      <span class="nb">arch</span>/x86/boot/setup.elf <span class="c"># 链接 setup.elf 文件和 header.o 文件生成 setup.bin 文件</span>
  OBJCOPY <span class="nb">arch</span>/x86/boot/setup.bin
  BUILD   <span class="nb">arch</span>/x86/boot/bzImage <span class="c"># 最后将 vmlinux.bin 和 setup.bin 文件链接到一起生成 bzImage 内核镜像文件</span>
Setup is 15612 bytes <span class="o">(</span>padded to 15872 bytes<span class="o">)</span><span class="nb">.</span>
System is 6254 kB
CRC 88b350d1 <span class="c">#生成 CRC 校验码，添加到bzImage 内核镜像的末尾</span>
Kernel: <span class="nb">arch</span>/x86/boot/bzImage is ready  <span class="o">(</span><span class="c">#1)</span>
</code></pre></div></div>

<p>整个从 vmlinux 内核镜像文件生成一个可被加载启动的内核镜像文件的过程可以用下面这张图来描述：</p>

<p><img src="https://picturebed.obs.cn-east-2.myhuaweicloud.com/blogPictures/14984462874879.jpg" alt="" /></p>

<p>有关 x86 架构 Linux Kernel 启动相关的具体细节可以查看内核源码中的文档：<a href="https://www.kernel.org/doc/Documentation/x86/boot.txt">THE LINUX/x86 BOOT PROTOCOL</a></p>

<h2 id="linux-kernel-加载过程">Linux Kernel 加载过程</h2>

<p>Bootloader 将内核镜像加载到物理内存之后，内存的布局如下所示：</p>

<p><img src="https://picturebed.obs.cn-east-2.myhuaweicloud.com/blogPictures/14984488084415.jpg" alt="" /></p>

<p>整个Linux Kernel 的加载过程就是对 Linux Kernel 镜像分阶段加载，然后在实模式中进行一些基本硬件的设置，建立页表等操作之后，跳转到保护模式下的内核入口开始执行。</p>

<h2 id="实模式下内核加载过程">实模式下内核加载过程</h2>
<p>Bootloader 在找到内核镜像之后，第一步做的工作就是将内核镜像文件中的起始第一部分 <strong>boot/setup.bin</strong> 加载到 <strong>0x7c00</strong> 地址之上的物理内存中，然后跳转到 setup.bin 文件中的入口地址开始执行，注意这部分的代码是在<strong>实模式</strong>下运行的。</p>

<p>如在 <strong>Linux Kernel 镜像生成过程</strong> 小节中可启动的内核镜像图所示，boot/setup.bin 文件是由 <strong>boot sector</strong>（注意这个 boot sector 和 MBR 扇区是不一样的，是内核中遗留下来的一块地方，现在基本不怎么使用这块地方了，可能在其他体系架构的内核镜像中会使用这一部分来存储一些参数） 和 <strong>setup 代码</strong> 组成，其中 boot sector 占用了 512 字节的空间。</p>

<p>实模式设置（setup）阶段主要完成一些<strong>体系结构相关的硬件初始化工作</strong>，涉及的文件有 <em>arch/x86/boot/header.S</em>、链接脚本<em>setup.ld</em>、<em>arch/x86/boot/main.c</em>。header.S 第一部分定义了 .bstext、.bsdata、.header 这 3 个节，共同构成了vmlinuz 的第一个512字节(即引导扇区的内容)。常量 BOOTSEG 和SYSSEG 定义了引导扇区和内核的载入的地址。</p>

<p>header.S 文件中的部分代码如下所示：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BOOTSEG     = 0x07C0        /* original address of boot-sector */
SYSSEG      = 0x1000        /* historical load address &gt;&gt; 4 */

......

    .code16
    .section ".bstext", "ax" /* .bstext 小节 */

    .global bootsect_start
bootsect_start:
#ifdef CONFIG_EFI_STUB
    # "MZ", MS-DOS header
    .byte 0x4d
    .byte 0x5a
#endif

    # Normalize the start address
    ljmp    $BOOTSEG, $start2

start2:
    movw    %cs, %ax
    movw    %ax, %ds
    movw    %ax, %es
    movw    %ax, %ss
    xorw    %sp, %sp
    sti
    cld

    movw    $bugger_off_msg, %si
    
......

.section ".bsdata", "a" /* .bsdata 小节 */
bugger_off_msg:
    .ascii  "Use a boot loader.\r\n"
    .ascii  "\n"
    .ascii  "Remove disk and press any key to reboot...\r\n"
    .byte   0
    
......

# Kernel attributes; used by setup.  This is part 1 of the
    # header, from the old boot sector.

    .section ".header", "a" /* .header 小节 */
    .globl  sentinel
sentinel:   .byte 0xff, 0xff        /* Used to detect broken loaders */

    .globl  hdr
hdr:
setup_sects:    .byte 0         /* Filled in by build.c */
root_flags: .word ROOT_RDONLY
syssize:    .long 0         /* Filled in by build.c */
ram_size:   .word 0         /* Obsolete */
vid_mode:   .word SVGA_MODE
root_dev:   .word 0         /* Filled in by build.c */
boot_flag:  .word 0xAA55

/*---------------------512 字节偏移处-----------------------------*/

/* _start 位置是内核装载时实模式执行代码的入口地址
    这一点我们可以从 setup.ld 脚本文件中的 ENTRY(_start) 
    得知
 */
/* 从 _start 开始真正的进入实模式开始执行 setup 代码 */
# offset 512, entry point

    .globl  _start
_start:
        # Explicitly enter this as bytes, or the assembler
        # tries to generate a 3-byte jump here, which causes
        # everything else to push off to the wrong offset.
        .byte   0xeb        # short (2-byte) jump
        .byte   start_of_setup-1f

......

# Zero the bss
    movw    $__bss_start, %di
    movw    $_end+3, %cx
    xorl    %eax, %eax
    subw    %di, %cx
    shrw    $2, %cx
    rep; stosl

# Jump to C code (should not return)
    calll   main

# Setup corrupt somehow...
setup_bad:
    movl    $setup_corrupt, %eax
    calll   puts
    # Fall through...

    .globl  die
    .type   die, @function
die:
    hlt
    jmp die

    .size   die, .-die

    .section ".initdata", "a"
</code></pre></div></div>

<p><strong>setup.ld 链接脚本</strong>的工作就是将 header.S 中的各个小节按照 ELF 可执行文件格式链接在一起，最终生成 <strong>boot/setup.bin</strong>  文件，setup.ld 文件中的部分内容如下所示：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*
 * setup.ld
 *
 * Linker script for the i386 setup code
 */
OUTPUT_FORMAT("elf32-i386", "elf32-i386", "elf32-i386")
OUTPUT_ARCH(i386)
ENTRY(_start)

SECTIONS
{
    . = 0;
    .bstext     : { *(.bstext) }
    .bsdata     : { *(.bsdata) }

    . = 495;
    .header     : { *(.header) }
    .entrytext  : { *(.entrytext) }
    .inittext   : { *(.inittext) }
    .initdata   : { *(.initdata) }
    __end_init = .;

    .text       : { *(.text) }
    .text32     : { *(.text32) }

    . = ALIGN(16);
    .rodata     : { *(.rodata*) }
    
    ......

    . = ALIGN(16);
    .data       : { *(.data*) }

    .signature  : {
        setup_sig = .;
        LONG(0x5a5aaa55)
    }
    
    ....
}
</code></pre></div></div>

<p>由 setup.ld 中的 <code class="language-plaintext highlighter-rouge">ENTRY(_start)</code> 可知，<strong>header.S</strong> 文件中 <code class="language-plaintext highlighter-rouge">_start</code> 汇编程序是 bzImage 内核映像开始执行的入口点，即引导扇区之后的开始处（偏移512字节处），它会准备大量的<strong>bootloader</strong> 参数，最后的 <code class="language-plaintext highlighter-rouge">call main</code> 跳转到 <code class="language-plaintext highlighter-rouge">arch/x86/boot/main.c:main()</code> 函数处执行，这就是众所周知的 main 函数，它们都工作在<strong>实模式</strong>下。</p>

<p><strong>arch/x86/boot/main.c:main()</strong> 函数主要完成的工作：</p>

<ol>
  <li>调用 <code class="language-plaintext highlighter-rouge">copy_boot_params</code> 函数把位于第一个扇区(boot/setup.bin 中的 boot sector)的参数复制到 <strong>boot_params</strong> 变量中，boot_params 变量位于 <strong>boot/setup.bin</strong> 的数据段。</li>
  <li>初始化早期启动状态下的控制台（console）。</li>
  <li>初始化堆空间。</li>
  <li>检测 CPU 相关信息。</li>
  <li>通过向 BIOS 查询的方式，收集硬件相关信息，并将结果存放在第 0 号物理页中。</li>
  <li>调用了 <code class="language-plaintext highlighter-rouge">arch/x86/boot/pm.c:go_to_protected_mode(void) ---&gt; arch/x86/boot/pmjump.S:protected_mode_jump()</code> 函数，从 bzImage 中的 <code class="language-plaintext highlighter-rouge">boot/setup.bin</code> <strong>实模式部分</strong>的代码跳转到了 <code class="language-plaintext highlighter-rouge">boot/vmlinux.bin</code> <strong>保护模式</strong>的代码。</li>
</ol>

<h2 id="保护模式下内核加载过程">保护模式下内核加载过程</h2>
<p>执行完 <strong>boot/setup.bin</strong> 部分的代码之后，Bootloader 就接着把内核镜像 bzImage 中的第二部分 <strong>boot/vmlinux.bin</strong> 加载到物理内存中起始地址为 <strong>0x100000</strong> 的位置，boot/vmlinux.bin 代码在<strong>保护模式</strong>下的入口是 <code class="language-plaintext highlighter-rouge">arch/x86/boot/compressed/head_32.S::startup_32</code> 汇编代码，这段汇编代码中主要完成两个工作：</p>

<ul>
  <li>将 boot/vmlinux.bin 文件中解压内核的代码拷贝到物理内存中 boot/vmlinux.bin 的后面。</li>
  <li>初始化 stack 和 heap 空间。</li>
  <li>解压缩内核，解压缩后的内核就是我们从源码编译得到的 vmlinux ELF 可执行文件。</li>
  <li>如果有选项指定，可能还需要对解压后的内核地址进行一个重定位（Relocate）。</li>
  <li>最后，跳转到解压缩后的内核文件 vmlinux 中的入口函数开始启动内核。</li>
</ul>

<p>解压缩后的内核文件 vmlinux 的入口函数是 <code class="language-plaintext highlighter-rouge">arch/x86/kernel/head_32.S::startup_32</code> 中的startup_32（32位内核的入口函数），在这个函数中会拷贝 <strong>boot_params</strong> 结构体变量以及<strong>boot_command_line</strong>，初始化页表，开启分页机制。startup_32() 汇编代码会接着调用 <code class="language-plaintext highlighter-rouge">init/main.c:start_kernel()</code> 函数，这是Linux 内核的启动函数。<code class="language-plaintext highlighter-rouge">init/main.c</code> 文件是整个 Linux 内核的中央联结点。每种体系结构都会执行一些底层设置函数，然后执行名为<code class="language-plaintext highlighter-rouge">start_kernel</code> 的函数（在 init/main.c 中可以找到这个函数）。可以认为 main.c 是内核的“粘合剂（glue）”，之前执行的代码都是<strong>各种体系结构相关</strong>的代码，一旦到达<strong>start_kernel()</strong>，就与体系结构无关了。</p>

<p>至此，Linux Kernel 的加载过程就分析完毕了，整个过程可以用下面这张图来总结一下：</p>

<p><img src="https://picturebed.obs.cn-east-2.myhuaweicloud.com/blogPictures/14984654332695.jpg" alt="" /></p>

<h1 id="参考文章">参考文章</h1>

<ol>
  <li><a href="http://linux-development-for-fresher.blogspot.com/2012/07/linux-boot-process-in-nutshell.html">Linux Boot Process in a nutshell</a></li>
  <li><a href="https://www.kernel.org/doc/Documentation/efi-stub.txt">The EFI Boot Stub</a></li>
  <li><a href="https://www.kernel.org/doc/Documentation/efi-stub.txt">Archlinux-EFISTUB</a></li>
  <li><a href="http://www.wowotech.net/armv8a_arch/UEFI.html">ARM64的启动过程之（五）：UEFI</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface">Unified Extensible Firmware Interface - ArchWiki</a></li>
  <li><a href="https://blog.woodelf.org/2014/05/28/uefi-boot-how-it-works.html">UEFI 启动：实际工作原理</a></li>
  <li><a href="http://www.rodsbooks.com/efi-bootloaders/principles.html">Managing EFI Boot Loaders for Linux:BasicPrinciples</a></li>
  <li><a href="http://blog.csdn.net/duguteng/article/details/7552774">x86中断向量表</a></li>
  <li><a href="http://wiki.osdev.org/Boot_Sequence">Boot Sequence</a></li>
  <li><a href="http://www.linuxidc.com/Linux/2014-10/108033.htm">Linux内核启动过程分析</a></li>
</ol>


</article>



<section class="tags">
  <strong>Tags:</strong> <a href="/tag/内核">内核</a>,&nbsp;<a href="/tag/操作系统">操作系统</a>
</section>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=Linux+%E5%86%85%E6%A0%B8%E5%8A%A0%E8%BD%BD%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90&url=https%3A%2F%2Fflyflypeng.tech%2F%25E5%2586%2585%25E6%25A0%25B8%2F2017%2F06%2F27%2FLinux-%25E5%2586%2585%25E6%25A0%25B8%25E5%258A%25A0%25E8%25BD%25BD%25E5%2590%25AF%25E5%258A%25A8%25E8%25BF%2587%25E7%25A8%258B%25E5%2588%2586%25E6%259E%2590.html&via=flyflypeng_bear"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
</section>

	<section class="post-navigation">
		<span class="prev-post">
			
				<a href="/%E5%86%85%E6%A0%B8/2017/06/14/ramfs-rootfs-initramfs%E7%9A%84%E5%8C%BA%E5%88%AB.html">
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
					</span>
					<span class="page-number">ramfs, tmpfs, rootfs, initramfs的区别</span>
				</a>
			
		</span>
		<span class="next-post">
			
				<a href="/linux/2017/07/11/Linux-IO%E6%A8%A1%E5%9E%8B.html">
					<span class="page-number">Linux I/O 模型详解</span>
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-right fa-stack-1x fa-inverse"></i>
					</span>
				</a>
			
		</span>
	</section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'flyflypeng-tech';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">Fly Higher's Blog</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        <li class="nav-link"><a href="/about/">About</a>
        <li class="nav-link"><a href="/posts/">Posts</a>
        <li class="nav-link"><a href="/project/">Projects</a>
       <!--  
        
          <li class="nav-link"><a href="/about/">About</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/posts/">Posts</a>
        
        
        
          <li class="nav-link"><a href="/project/">Projects</a>
        
        
        
          <li class="nav-link"><a href="/tag/keyboard/">keyboard</a>
        
        
        
          <li class="nav-link"><a href="/tag/virtual/">virtual</a>
        
        
        
          <li class="nav-link"><a href="/tag/android/">Android</a>
        
        
        
          <li class="nav-link"><a href="/tag/opencv/">opencv</a>
        
        
        
          <li class="nav-link"><a href="/tag/markdown/">Markdown</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E8%8B%B1%E8%AF%AD/">英语</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E5%AD%A6%E4%B9%A0/">学习</a>
        
        
        
          <li class="nav-link"><a href="/tag/hexo/">Hexo</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E5%8D%9A%E5%AE%A2/">博客</a>
        
        
        
          <li class="nav-link"><a href="/tag/ubuntu/">Ubuntu</a>
        
        
        
          <li class="nav-link"><a href="/tag/firefox/">Firefox</a>
        
        
        
          <li class="nav-link"><a href="/tag/python/">Python</a>
        
        
        
          <li class="nav-link"><a href="/tag/make/">make</a>
        
        
        
          <li class="nav-link"><a href="/tag/makefile/">Makefile</a>
        
        
        
          <li class="nav-link"><a href="/tag/linux/">Linux</a>
        
        
        
          <li class="nav-link"><a href="/tag/sublimetext/">SublimeText</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E5%86%85%E6%A0%B8/">内核</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E8%B0%83%E5%BA%A6/">调度</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E7%A1%AC%E7%9B%98/">硬盘</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a>
        
        
        
          <li class="nav-link"><a href="/tag/terminator/">Terminator</a>
        
        
        
          <li class="nav-link"><a href="/tag/cpu/">CPU</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">体系结构</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/">系统调用</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86/">时间管理</a>
        
        
        
          <li class="nav-link"><a href="/tag/vnc/">VNC</a>
        
        
        
          <li class="nav-link"><a href="/tag/rfb/">RFB</a>
        
        
        
          <li class="nav-link"><a href="/tag/container-of/">container_of</a>
        
        
        
          <li class="nav-link"><a href="/tag/offsetof/">offsetof</a>
        
        
        
          <li class="nav-link"><a href="/tag/cs/">CS</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E5%9F%BA%E7%A1%80/">基础</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E9%98%85%E8%AF%BB/">阅读</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E4%B9%A6%E5%8D%95/">书单</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E5%B0%8F%E8%AF%B4/">小说</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E6%8A%80%E6%9C%AF/">技术</a>
        
        
        
          <li class="nav-link"><a href="/tag/ndk/">NDK</a>
        
        
        
          <li class="nav-link"><a href="/tag/debug/">Debug</a>
        
        
        
          <li class="nav-link"><a href="/tag/tombstone/">Tombstone</a>
        
        
        
          <li class="nav-link"><a href="/tag/eof/">EOF</a>
        
        
        
          <li class="nav-link"><a href="/tag/git/">Git</a>
        
        
        
          <li class="nav-link"><a href="/tag/ppa/">PPA</a>
        
        
        
          <li class="nav-link"><a href="/tag/apt/">APT</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E5%90%8C%E6%AD%A5/">同步</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85/">生产者消费者</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA/">环形缓冲区</a>
        
        
        
          <li class="nav-link"><a href="/tag/ringbuffer/">RingBuffer</a>
        
        
        
          <li class="nav-link"><a href="/tag/aosp/">AOSP</a>
        
        
        
          <li class="nav-link"><a href="/tag/hal/">HAL</a>
        
        
        
          <li class="nav-link"><a href="/tag/ramfs/">ramfs</a>
        
        
        
          <li class="nav-link"><a href="/tag/tmpfs/">tmpfs</a>
        
        
        
          <li class="nav-link"><a href="/tag/rootfs/">rootfs</a>
        
        
        
          <li class="nav-link"><a href="/tag/initramfs/">initramfs</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">文件系统</a>
        
        
        
          <li class="nav-link"><a href="/tag/unix/">Unix</a>
        
        
        
          <li class="nav-link"><a href="/tag/i-o/">I/O</a>
        
        
        
          <li class="nav-link"><a href="/tag/graphic/">Graphic</a>
        
        
        
          <li class="nav-link"><a href="/tag/opengles/">OpenGLES</a>
        
        
        
          <li class="nav-link"><a href="/tag/egl/">EGL</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a>
        
        
        
          <li class="nav-link"><a href="/tag/qemu/">QEMU</a>
        
        
        
          <li class="nav-link"><a href="/tag/kvm/">KVM</a>
        
        
        
          <li class="nav-link"><a href="/tag/mac/">Mac</a>
        
        
        
          <li class="nav-link"><a href="/tag/jekyll/">Jekyll</a>
        
        
        
          <li class="nav-link"><a href="/tag/iterm2/">iTerm2</a>
        
        
        
          <li class="nav-link"><a href="/tag/zsh/">zsh</a>
        
        
        
          <li class="nav-link"><a href="/tag/kubernetes/">kubernetes</a>
        
        
        
          <li class="nav-link"><a href="/tag/k8s/">k8s</a>
        
        
        
          <li class="nav-link"><a href="/tag/cloudnative/">cloudnative</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E6%88%B7%E5%A4%96/">户外</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E9%9C%B2%E8%90%A5/">露营</a>
        
        
        
          <li class="nav-link"><a href="/tag/camp/">camp</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E7%AC%94%E8%AE%B0/">笔记</a>
        
        
        
          <li class="nav-link"><a href="/tag/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a>
        
        
        
          <li class="nav-link"><a href="/tag/ptrace/">ptrace</a>
        
        
        
          <li class="nav-link"><a href="/tag/sandbox/">sandbox</a>
        
        
        
          <li class="nav-link"><a href="/tag/kata-containers/">kata-containers</a>
        
        
        
          <li class="nav-link"><a href="/category/android/">android</a>
        
        
        
          <li class="nav-link"><a href="/category/%E5%88%A9%E5%99%A8/">利器</a>
        
        
        
          <li class="nav-link"><a href="/category/%E5%AD%A6%E4%B9%A0-%E6%95%88%E7%8E%87/">学习&效率</a>
        
        
        
          <li class="nav-link"><a href="/category/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>
        
        
        
          <li class="nav-link"><a href="/category/linux/">linux</a>
        
        
        
          <li class="nav-link"><a href="/category/%E5%86%85%E6%A0%B8/">内核</a>
        
        
        
          <li class="nav-link"><a href="/category/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">体系结构</a>
        
        
        
          <li class="nav-link"><a href="/category/%E7%94%9F%E6%B4%BB/">生活</a>
        
        
        
          <li class="nav-link"><a href="/category/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a>
        
        
        
          <li class="nav-link"><a href="/category/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a>
        
        
        
          <li class="nav-link"><a href="/category/%E6%88%B7%E5%A4%96/">户外</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
         -->
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:flyflyflypeng@gmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">flyflyflypeng@gmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://twitter.com/flyflypeng_bear" title="Follow me on Twitter">
              <i class="fa fa-twitter"></i>
              <span class="username">flyflypeng_bear</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://github.com/flyflypeng" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">flyflypeng</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://www.instagram.com/FlyFlyPeng/" title="Follow me on Instagram">
              <i class="fa fa-instagram"></i>
              <span class="username">FlyFlyPeng</span>
            </a>
          </li>
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">Do one thing and do it well.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });
});

</script>






  </body>

</html>
